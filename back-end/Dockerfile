FROM node:18

WORKDIR /app

# ðŸ‘‡ à¸£à¸±à¸šà¸•à¸±à¸§à¹à¸›à¸£ DATABASE_URL à¸ˆà¸²à¸à¸•à¸­à¸™ build
ARG DATABASE_URL
ENV DATABASE_URL=${DATABASE_URL}

COPY package*.json ./
RUN npm install --omit=dev

COPY . .

# ðŸ‘‡ inject DATABASE_URL à¸¥à¸‡ .env à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§ (à¹€à¸žà¸·à¹ˆà¸­à¹ƒà¸«à¹‰ Prisma à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¹„à¸”à¹‰)
RUN echo "DATABASE_URL=${DATABASE_URL}" > prisma/.env && \
    npx prisma db push && \
    npx prisma generate && \
    rm prisma/.env

EXPOSE 5000

CMD ["node", "src/server.js"]
